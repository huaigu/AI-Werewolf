# AI-狼人杀设计文档

本目录包含 AI-狼人杀游戏项目的综合技术文档，重点关注架构、API 和实现细节。

## 文档索引

### 📋 [架构概览](./architecture-overview.md)
全面的系统架构分析，包含：
- 高层系统设计和组件关系
- 技术栈和架构决策
- Monorepo 结构和包组织  
- 游戏主控和 AI 玩家服务架构
- 可扩展性考虑和未来改进

### 🔌 [玩家 API 参考](./player-api-reference.md)  
主控-玩家通信的完整 API 文档：
- HTTP 端点规范和请求/响应格式
- 角色特定的 API 行为（狼人、预言家、女巫、村民）
- Zod 模式验证模式
- 错误处理和状态码
- 配置和个性系统集成

### 📡 [通信模式](./communication-patterns.md)
主控-玩家交互模式的详细分析：
- 中心辐射型通信架构
- 同步 HTTP 请求/响应流程
- 顺序处理模型和时序
- 重试逻辑、超时处理和优雅降级
- 性能特性和瓶颈分析

### 🎮 [游戏流程与状态管理](./game-flow-state-management.md)
游戏机制和状态处理的深入介绍：
- 有限状态机 (FSM) 实现
- 阶段转换（准备 → 夜晚 → 白天 → 投票 → 结束）
- 集中式 vs 分布式状态管理
- MobX 响应式状态模式
- 胜利条件评估和游戏完成逻辑
- 错误恢复和状态一致性机制

## 关键架构洞察

### 主控-玩家交互模型
系统使用**集中编排**模式：
- 游戏主控维护权威状态并控制游戏流程
- AI 玩家是响应富上下文请求的无状态服务
- 通信纯基于 HTTP，使用结构化 JSON 载荷
- 每个玩家服务在独立端口上运行（3001-3008）

### 状态管理理念  
- **单一事实来源**：游戏主控持有所有权威状态
- **富上下文请求**：每个 API 调用都包含完整游戏上下文
- **无状态玩家**：AI 服务不维护持久游戏状态
- **响应式 UI**：MobX 实现状态变化的自动 UI 更新

### AI 集成模式
- **Zod 模式验证**：所有 AI 响应都经过类型安全验证
- **个性驱动提示**：可配置的 AI 行为和决策制定
- **Langfuse 遥测**：AI 交互的综合可观测性
- **优雅降级**：AI 生成失败时的回退响应

### 技术创新
- **Bun 优先开发**：无需构建步骤的直接 TypeScript 执行
- **带工作区的 Monorepo**：跨包共享类型和工具
- **类型安全的 AI 响应**：运行时验证防止 AI 幻觉问题
- **分布式 AI 玩家**：每个玩家作为独立服务以实现可扩展性

## 代码库入门指南

1. **首先阅读架构概览**，获得高层理解
2. **查看玩家 API 参考**，了解实现细节
3. **学习通信模式**，掌握集成方法
4. **研究游戏流程文档**，理解状态管理模式

## 开发工作流集成

本文档支持 `/CLAUDE.md` 中定义的开发工作流：

- **常用命令**：在项目根目录 `CLAUDE.md` 中有文档记录
- **架构模式**：在这些设计文档中详细说明  
- **API 契约**：完整规范，包含示例和模式
- **状态管理**：MobX 模式和响应式编程指南

## 未来文档扩展

需要补充的文档领域：
- **部署指南**：生产部署模式和 Docker 配置
- **测试策略**：AI 测试方法和测试数据管理
- **性能优化**：分析和优化指南
- **安全考虑**：AI 安全和游戏完整性措施
- **监控和告警**：生产可观测性配置